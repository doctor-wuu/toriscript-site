---
// RelatedCard.astro
import { getCollection } from 'astro:content';
const { slug, heading } = Astro.props;

const articles = await getCollection('articles');
const article = articles.find((a) => a.slug === slug);
if (!article) {
  throw new Error(`記事 "${slug}" が見つかりません`);
}

const title = article.data.title;
const intro = article.data.intro || '';
const thumb = `/` + (article.data.introImage ?? 'images/blank.jpg');
---

<div class="related-card-container mx-auto my-6 px-4">
  <div class="related-card border border-[#EEE8E6] rounded-md overflow-hidden relative flex gap-4 p-4 max-w-[95%] not-prose">
    <div class="related-label absolute -top-3 left-4 bg-[#82A0AA] text-white text-xs font-semibold px-2 py-1 rounded">
      {heading}
    </div>
    <a href={`/articles/${slug}/`} class="flex gap-4 items-start no-underline w-full">
      <div class="w-[120px] min-w-[120px] aspect-[4/3] overflow-hidden rounded-md flex-shrink-0">
        <img
          src={thumb}
          alt={`${title} のサムネイル`}
          class="w-full h-full object-cover block"
          loading="lazy"
          decoding="async"
        />
      </div>
      <div class="flex flex-col justify-start w-full">
        <p class="text-base font-bold text-[#6a6a6a] break-words leading-snug line-clamp-3 m-0 p-0">
          {title}
        </p>
        {intro && (
          <p class="text-sm text-[#888888] leading-snug line-clamp-3 mt-1">
            {intro}
          </p>
        )}
      </div>
    </a>
  </div>
</div>


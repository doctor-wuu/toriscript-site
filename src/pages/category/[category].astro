---
import { getCollection } from 'astro:content';
import Layout from '../../layouts/Layout.astro';
import { categoryMap } from '@/data/categoryMap.ts';


const { category } = Astro.params;

// ğŸ§  ã“ã‚Œã¯ HTML ã‚’ç”Ÿæˆã™ã‚‹æœ¬ä½“å‡¦ç†
const allArticles = await getCollection('articles');
const articles = allArticles.filter(
  (article) => categoryMap[article.data.category]?.slug === category
);
const categoryLabel = categoryMap[
  allArticles.find((a) => categoryMap[a.data.category]?.slug === category)?.data.category
]?.label;

console.log("ğŸŸ¡ category:", category);
console.log("ğŸŸ¢ filtered articles:", articles.map(a => a.slug));

// âœ… ã“ã‚ŒãŒãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°å‡¦ç†ï¼ export ã‚’å¿˜ã‚Œãšã«ï¼ï¼
export async function getStaticPaths() {
  const allArticles = await getCollection('articles');

  console.log("ğŸŸ  Articles loaded:", allArticles.map(a => a.slug));

  const slugs = Array.from(
    new Set(
      allArticles
        .map((article) => {
          const id = article.data.category;
          const slug = categoryMap[id]?.slug;
          console.log("ğŸ”¹ ID:", id, "â†’ slug:", slug);
          return slug;
        })
        .filter(Boolean)
    )
  );

  console.log("âœ… Static paths:", slugs);

  return slugs.map((slug) => ({
    params: { category: slug },
  }));
}



---


<Layout title={`${categoryLabel} ã®è¨˜äº‹ä¸€è¦§`}>
  <div class="max-w-[48rem] mx-auto">
    <h1 class="text-2xl font-bold mb-6 text-center text-[#4a4a4a]">
      {categoryLabel} ã®è¨˜äº‹ä¸€è¦§
    </h1>

    {articles.length > 0 ? (
      <ul class="space-y-6">
        {articles.map((article) => (
          <li class="border-b pb-4">
            <a href={`/articles/${article.slug}`} class="block hover:underline">
              <h2 class="text-xl font-semibold">{article.data.title}</h2>
              {article.data.description && (
                <p class="text-sm text-gray-500">{article.data.description}</p>
              )}
            </a>
          </li>
        ))}
      </ul>
    ) : (
      <p class="text-sm text-gray-400">ã“ã®è¨˜äº‹ã‚«ãƒ†ã‚´ãƒªã«ã¯ã¾ã æŠ•ç¨¿ãŒã‚ã‚Šã¾ã›ã‚“ã€‚</p>
    )}

  </div>
</Layout>

